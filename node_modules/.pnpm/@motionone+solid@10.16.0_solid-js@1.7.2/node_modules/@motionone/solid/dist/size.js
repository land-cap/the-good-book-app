import{createComponent as t,mergeProps as e,Dynamic as n,memo as i}from"solid-js/web";import{createContext as r,useContext as o,splitProps as s,onMount as a,onCleanup as l,createEffect as c}from"solid-js";import{resolveFirst as u}from"@solid-primitives/refs";import{createSwitchTransition as h}from"@solid-primitives/transition-group";function f(t,e){-1===t.indexOf(e)&&t.push(e)}const p=(t,e,n)=>Math.min(Math.max(n,t),e),d={duration:.3,delay:0,endDelay:0,repeat:0,easing:"ease"},m=t=>"number"==typeof t,y=t=>Array.isArray(t)&&!m(t[0]);const g=(t,e,n)=>-n*t+n*e+t,v=()=>{},b=t=>t,w=(t,e,n)=>e-t==0?1:(n-t)/(e-t);function E(t,e){const n=t[t.length-1];for(let i=1;i<=e;i++){const r=w(0,e,i);t.push(g(n,1,r))}}function O(t,e=function(t){const e=[0];return E(e,t-1),e}(t.length),n=b){const i=t.length,r=i-e.length;return r>0&&E(e,r),r=>{let o=0;for(;o<i-2&&!(r<e[o+1]);o++);let s=p(0,1,w(e[o],e[o+1],r));const a=function(t,e){return y(t)?t[((t,e,n)=>{const i=e-t;return((n-t)%i+i)%i+t})(0,t.length,e)]:t}(n,o);return s=a(s),g(t[o],t[o+1],s)}}const A=t=>Array.isArray(t)&&m(t[0]),S=t=>"object"==typeof t&&Boolean(t.createAnimation),x=t=>"function"==typeof t,T=t=>1e3*t,D=(t,e,n)=>(((1-3*n+3*e)*t+(3*n-6*e))*t+3*e)*t;function j(t,e,n,i){if(t===e&&n===i)return b;const r=e=>function(t,e,n,i,r){let o,s,a=0;do{s=e+(n-e)/2,o=D(s,i,r)-t,o>0?n=s:e=s}while(Math.abs(o)>1e-7&&++a<12);return s}(e,0,1,t,n);return t=>0===t||1===t?t:D(r(t),e,i)}const M={ease:j(.25,.1,.25,1),"ease-in":j(.42,0,1,1),"ease-in-out":j(.42,0,.58,1),"ease-out":j(0,0,.58,1)},P=/\((.*?)\)/;function k(t){if(x(t))return t;if(A(t))return j(...t);if(M[t])return M[t];if(t.startsWith("steps")){const e=P.exec(t);if(e){const t=e[1].split(",");return((t,e="end")=>n=>{const i=(n="end"===e?Math.min(n,.999):Math.max(n,.001))*t,r="end"===e?Math.floor(i):Math.ceil(i);return p(0,1,r/t)})(parseFloat(t[0]),t[1].trim())}}return b}class V{constructor(t,e=[0,1],{easing:n,duration:i=d.duration,delay:r=d.delay,endDelay:o=d.endDelay,repeat:s=d.repeat,offset:a,direction:l="normal"}={}){if(this.startTime=null,this.rate=1,this.t=0,this.cancelTimestamp=null,this.easing=b,this.duration=0,this.totalDuration=0,this.repeat=0,this.playState="idle",this.finished=new Promise(((t,e)=>{this.resolve=t,this.reject=e})),n=n||d.easing,S(n)){const t=n.createAnimation(e);n=t.easing,e=t.keyframes||e,i=t.duration||i}this.repeat=s,this.easing=y(n)?b:k(n),this.updateDuration(i);const c=O(e,a,y(n)?n.map(k):b);this.tick=e=>{var n;let i=0;i=void 0!==this.pauseTime?this.pauseTime:(e-this.startTime)*this.rate,this.t=i,i/=1e3,i=Math.max(i-r,0),"finished"===this.playState&&void 0===this.pauseTime&&(i=this.totalDuration);const s=i/this.duration;let a=Math.floor(s),u=s%1;!u&&s>=1&&(u=1),1===u&&a--;const h=a%2;("reverse"===l||"alternate"===l&&h||"alternate-reverse"===l&&!h)&&(u=1-u);const f=i>=this.totalDuration?1:Math.min(u,1),p=c(this.easing(f));t(p);void 0===this.pauseTime&&("finished"===this.playState||i>=this.totalDuration+o)?(this.playState="finished",null===(n=this.resolve)||void 0===n||n.call(this,p)):"idle"!==this.playState&&(this.frameRequestId=requestAnimationFrame(this.tick))},this.play()}play(){const t=performance.now();this.playState="running",void 0!==this.pauseTime?this.startTime=t-this.pauseTime:this.startTime||(this.startTime=t),this.cancelTimestamp=this.startTime,this.pauseTime=void 0,this.frameRequestId=requestAnimationFrame(this.tick)}pause(){this.playState="paused",this.pauseTime=this.t}finish(){this.playState="finished",this.tick(0)}stop(){var t;this.playState="idle",void 0!==this.frameRequestId&&cancelAnimationFrame(this.frameRequestId),null===(t=this.reject)||void 0===t||t.call(this,!1)}cancel(){this.stop(),this.tick(this.cancelTimestamp)}reverse(){this.rate*=-1}commitStyles(){}updateDuration(t){this.duration=t,this.totalDuration=t*(this.repeat+1)}get currentTime(){return this.t}set currentTime(t){void 0!==this.pauseTime||0===this.rate?this.pauseTime=t:this.startTime=performance.now()-t/this.rate}get playbackRate(){return this.rate}set playbackRate(t){this.rate=t}}var L=function(){};"production"!==process.env.NODE_ENV&&(L=function(t,e){if(!t)throw new Error(e)});class C{setAnimation(t){this.animation=t,null==t||t.finished.then((()=>this.clearAnimation())).catch((()=>{}))}clearAnimation(){this.animation=this.generator=void 0}}const R=new WeakMap;function $(t){return R.has(t)||R.set(t,{transforms:[],values:new Map}),R.get(t)}const B=["","X","Y","Z"],I={x:"translateX",y:"translateY",z:"translateZ"},q={syntax:"<angle>",initialValue:"0deg",toDefaultUnit:t=>t+"deg"},U={translate:{syntax:"<length-percentage>",initialValue:"0px",toDefaultUnit:t=>t+"px"},rotate:q,scale:{syntax:"<number>",initialValue:1,toDefaultUnit:b},skew:q},F=new Map,W=t=>`--motion-${t}`,_=["x","y","z"];["translate","scale","rotate","skew"].forEach((t=>{B.forEach((e=>{_.push(t+e),F.set(W(t+e),U[t])}))}));const z=(t,e)=>_.indexOf(t)-_.indexOf(e),H=new Set(_),N=t=>H.has(t),K=t=>t.sort(z).reduce(X,"").trim(),X=(t,e)=>`${t} ${e}(var(${W(e)}))`,Y=t=>t.startsWith("--"),Z=new Set;const G=(t,e)=>document.createElement("div").animate(t,e),J={cssRegisterProperty:()=>"undefined"!=typeof CSS&&Object.hasOwnProperty.call(CSS,"registerProperty"),waapi:()=>Object.hasOwnProperty.call(Element.prototype,"animate"),partialKeyframes:()=>{try{G({opacity:[1]})}catch(t){return!1}return!0},finished:()=>Boolean(G({opacity:[0,1]},{duration:.001}).finished),linearEasing:()=>{try{G({opacity:0},{easing:"linear(0, 1)"})}catch(t){return!1}return!0}},Q={},tt={};for(const t in J)tt[t]=()=>(void 0===Q[t]&&(Q[t]=J[t]()),Q[t]);const et=(t,e)=>x(t)?tt.linearEasing()?`linear(${((t,e)=>{let n="";const i=Math.round(e/.015);for(let e=0;e<i;e++)n+=t(w(0,i-1,e))+", ";return n.substring(0,n.length-2)})(t,e)})`:d.easing:A(t)?nt(t):t,nt=([t,e,n,i])=>`cubic-bezier(${t}, ${e}, ${n}, ${i})`;function it(t){return I[t]&&(t=I[t]),N(t)?W(t):t}const rt=(t,e)=>{e=it(e);let n=Y(e)?t.style.getPropertyValue(e):getComputedStyle(t)[e];if(!n&&0!==n){const t=F.get(e);t&&(n=t.initialValue)}return n},ot=(t,e,n)=>{e=it(e),Y(e)?t.style.setProperty(e,n):t.style[e]=n};function st(t,e,n,i={},r){const o=window.__MOTION_DEV_TOOLS_RECORD,s=!1!==i.record&&o;let a,{duration:l=d.duration,delay:c=d.delay,endDelay:u=d.endDelay,repeat:h=d.repeat,easing:p=d.easing,persist:g=!1,direction:w,offset:E,allowWebkitAcceleration:O=!1}=i;const A=$(t),D=N(e);let j=tt.waapi();D&&((t,e)=>{I[e]&&(e=I[e]);const{transforms:n}=$(t);f(n,e),t.style.transform=K(n)})(t,e);const M=it(e),P=function(t,e){return t.has(e)||t.set(e,new C),t.get(e)}(A.values,M),k=F.get(M);return function(t,e=!0){if(t&&"finished"!==t.playState)try{t.stop?t.stop():(e&&t.commitStyles(),t.cancel())}catch(t){}}(P.animation,!(S(p)&&P.generator)&&!1!==i.record),()=>{const f=()=>{var e,n;return null!==(n=null!==(e=rt(t,M))&&void 0!==e?e:null==k?void 0:k.initialValue)&&void 0!==n?n:0};let d=function(t,e){for(let n=0;n<t.length;n++)null===t[n]&&(t[n]=n?t[n-1]:e());return t}((t=>Array.isArray(t)?t:[t])(n),f);const A=function(t,e){var n;let i=(null==e?void 0:e.toDefaultUnit)||b;const r=t[t.length-1];if("string"==typeof r){const t=(null===(n=r.match(/(-?[\d.]+)([a-z%]*)/))||void 0===n?void 0:n[2])||"";t&&(i=e=>e+t)}return i}(d,k);if(S(p)){const t=p.createAnimation(d,"opacity"!==e,f,M,P);p=t.easing,d=t.keyframes||d,l=t.duration||l}if(Y(M)&&(tt.cssRegisterProperty()?function(t){if(!Z.has(t)){Z.add(t);try{const{syntax:e,initialValue:n}=F.has(t)?F.get(t):{};CSS.registerProperty({name:t,inherits:!1,syntax:e,initialValue:n})}catch(t){}}}(M):j=!1),D&&!tt.linearEasing()&&(x(p)||y(p)&&p.some(x))&&(j=!1),j){k&&(d=d.map((t=>m(t)?k.toDefaultUnit(t):t))),1!==d.length||tt.partialKeyframes()&&!s||d.unshift(f());const e={delay:T(c),duration:T(l),endDelay:T(u),easing:y(p)?void 0:et(p,l),direction:w,iterations:h+1,fill:"both"};a=t.animate({[M]:d,offset:E,easing:y(p)?p.map((t=>et(t,l))):void 0},e),a.finished||(a.finished=new Promise(((t,e)=>{a.onfinish=t,a.oncancel=e})));const n=d[d.length-1];a.finished.then((()=>{g||(ot(t,M,n),a.cancel())})).catch(v),O||(a.playbackRate=1.000001)}else if(r&&D)d=d.map((t=>"string"==typeof t?parseFloat(t):t)),1===d.length&&d.unshift(parseFloat(f())),a=new r((e=>{ot(t,M,A?A(e):e)}),d,Object.assign(Object.assign({},i),{duration:l,easing:p}));else{const e=d[d.length-1];ot(t,M,k&&m(e)?k.toDefaultUnit(e):e)}return s&&o(t,e,d,{duration:l,delay:c,easing:p,repeat:h,offset:E},"motion-one"),P.setAnimation(a),a}}const at=(t,e)=>t[e]?Object.assign(Object.assign({},t),t[e]):Object.assign({},t);function lt(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]])}return n}const ct={any:0,all:1};function ut(t,e,{root:n,margin:i,amount:r="any"}={}){if("undefined"==typeof IntersectionObserver)return()=>{};const o=function(t,e){var n;return"string"==typeof t?e?(null!==(n=e[t])&&void 0!==n||(e[t]=document.querySelectorAll(t)),t=e[t]):t=document.querySelectorAll(t):t instanceof Element&&(t=[t]),Array.from(t||[])}(t),s=new WeakMap,a=new IntersectionObserver((t=>{t.forEach((t=>{const n=s.get(t.target);if(t.isIntersecting!==Boolean(n))if(t.isIntersecting){const n=e(t);x(n)?s.set(t.target,n):a.unobserve(t.target)}else n&&(n(t),s.delete(t.target))}))}),{root:n,rootMargin:i,threshold:"number"==typeof r?r:ct[r]});return o.forEach((t=>a.observe(t))),()=>a.disconnect()}function ht(t,e){return function(t){return"object"==typeof t}(t)?t:t&&e?e[t]:void 0}let ft;function pt(){if(!ft)return;const t=ft.sort(mt).map(yt);t.forEach(gt),t.forEach(gt),ft=void 0}function dt(t){ft?f(ft,t):(ft=[t],requestAnimationFrame(pt))}const mt=(t,e)=>t.getDepth()-e.getDepth(),yt=t=>t.animateUpdates(),gt=t=>t.next(),vt=(t,e)=>new CustomEvent(t,{detail:{target:e}});function bt(t,e,n){t.dispatchEvent(new CustomEvent(e,{detail:{originalEvent:n}}))}function wt(t,e,n){t.dispatchEvent(new CustomEvent(e,{detail:{originalEntry:n}}))}const Et=(t,e,n)=>i=>{i.pointerType&&"mouse"!==i.pointerType||(n(),bt(t,e,i))},Ot={inView:{isActive:t=>Boolean(t.inView),subscribe:(t,{enable:e,disable:n},{inViewOptions:i={}})=>{const{once:r}=i,o=lt(i,["once"]);return ut(t,(i=>{if(e(),wt(t,"viewenter",i),!r)return e=>{n(),wt(t,"viewleave",e)}}),o)}},hover:{isActive:t=>Boolean(t.hover),subscribe:(t,{enable:e,disable:n})=>{const i=Et(t,"hoverstart",e),r=Et(t,"hoverend",n);return t.addEventListener("pointerenter",i),t.addEventListener("pointerleave",r),()=>{t.removeEventListener("pointerenter",i),t.removeEventListener("pointerleave",r)}}},press:{isActive:t=>Boolean(t.press),subscribe:(t,{enable:e,disable:n})=>{const i=e=>{n(),bt(t,"pressend",e),window.removeEventListener("pointerup",i)},r=n=>{e(),bt(t,"pressstart",n),window.addEventListener("pointerup",i)};return t.addEventListener("pointerdown",r),()=>{t.removeEventListener("pointerdown",r),window.removeEventListener("pointerup",i)}}}},At=["initial","animate",...Object.keys(Ot),"exit"],St=new WeakMap;function xt(t={},e){let n,i=e?e.getDepth()+1:0;const r={initial:!0,animate:!0},o={},s={};for(const n of At)s[n]="string"==typeof t[n]?t[n]:null==e?void 0:e.getContext()[n];const a=!1===t.initial?"animate":"initial";let l=lt(ht(t[a]||s[a],t.variants)||{},["transition"]);const c=Object.assign({},l);const u=(t,e)=>()=>{r[t]=e,dt(f)},h=()=>{for(const e in Ot){const i=Ot[e].isActive(t),r=o[e];i&&!r?o[e]=Ot[e].subscribe(n,{enable:u(e,!0),disable:u(e,!1)},t):!i&&r&&(r(),delete o[e])}},f={update:e=>{n&&(t=e,h(),dt(f))},setActive:(t,e)=>{n&&(r[t]=e,dt(f))},animateUpdates:function*(){var e,i;const o=l;l={};const s={};for(const n of At){if(!r[n])continue;const o=ht(t[n]);if(o)for(const n in o)"transition"!==n&&(l[n]=o[n],s[n]=at(null!==(i=null!==(e=o.transition)&&void 0!==e?e:t.transition)&&void 0!==i?i:{},n))}const a=new Set([...Object.keys(l),...Object.keys(o)]),u=[];a.forEach((t=>{var e,i,r;void 0===l[t]&&(l[t]=c[t]),i=o[t],r=l[t],typeof i==typeof r&&(Array.isArray(i)&&Array.isArray(r)?function(t,e){const n=e.length;if(n!==t.length)return!1;for(let i=0;i<n;i++)if(e[i]!==t[i])return!1;return!0}(i,r):i===r)||(null!==(e=c[t])&&void 0!==e||(c[t]=rt(n,t)),u.push(st(n,t,l[t],s[t],V)))})),yield;const h=u.map((t=>t())).filter(Boolean);if(!h.length)return;const f=l;n.dispatchEvent(vt("motionstart",f)),Promise.all(h.map((t=>t.finished))).then((()=>{n.dispatchEvent(vt("motioncomplete",f))})).catch(v)},getDepth:()=>i,getTarget:()=>l,getOptions:()=>t,getContext:()=>s,mount:t=>(L(Boolean(t),"Animation state must be mounted with valid Element"),n=t,St.set(n,f),h(),()=>{St.delete(n),function(t){ft&&function(t,e){const n=t.indexOf(e);n>-1&&t.splice(n,1)}(ft,t)}(f);for(const t in o)o[t]()}),isMounted:()=>Boolean(n)};return f}function Tt(t){const e={},n=[];for(let i in t){const r=t[i];N(i)&&(I[i]&&(i=I[i]),n.push(i),i=W(i));let o=Array.isArray(r)?r[0]:r;const s=F.get(i);s&&(o=m(r)?s.toDefaultUnit(r):r),e[i]=o}return n.length&&(e.transform=K(n)),e}var Dt=/([^:; ]*):\s*([^;]*)/g;function jt(t){const e={};let n;for(;n=Dt.exec(t);)e[n[1]]=n[2];return e}const Mt=r(),Pt=e=>{let n=!1!==e.initial;const i=t(Mt.Provider,{value:()=>n,get children(){return t(Bt.Provider,{value:void 0,get children(){return h(u((()=>e.children)),{appear:n,mode:e.exitBeforeEnter?"out-in":"parallel",onExit(t,e){const n=St.get(t);n&&n.getOptions().exit?kt(t,e):e()}})}})}});return n=!0,i},kt=(t,e)=>t.addEventListener("motioncomplete",e);function Vt(t,e,n,i){const r=xt(!1===n?.()?{...e(),initial:!1}:e(),i);return a((()=>{const i=r.mount(t());l((()=>{n&&e().exit?(r.setActive("exit",!0),kt(t(),i)):i()})),x(e)&&c((()=>r.update(e())))})),[r,Tt(r.getTarget())]}function Lt(t,e,n){const[i,r]=Vt((()=>t),"function"==typeof e?e:()=>e,n);for(const e in r)ot(t,e,r[e]);return i}function Ct(t,e){Lt(t,e,o(Mt))}const Rt=["initial","animate","inView","inViewOptions","hover","press","variants","transition","exit"],$t=["tag","ref","style","onMotionStart","onMotionComplete","onHoverStart","onHoverEnd","onPressStart","onPressEnd","onViewEnter","onViewLeave"],Bt=r(),It=r=>{const[a,,l]=s(r,Rt,$t),[c,u]=Vt((()=>h),(()=>({...a})),o(Mt),o(Bt));let h;return t(Bt.Provider,{value:c,get children(){return t(n,e({ref:t=>{h=t,r.ref?.(t)},get component(){return r.tag||"div"},get style(){return i((()=>!!r.style),!0)()?(t=r.style,e=u,"object"==typeof t&&"object"==typeof e?{...t,...e}:"string"==typeof t&&"string"==typeof e?`${t};${e}`:{..."object"==typeof t?t:jt(t),..."object"==typeof e?e:jt(e)}):u;var t,e},get"on:motionstart"(){return r.onMotionStart},get"on:motioncomplete"(){return r.onMotionComplete},get"on:hoverstart"(){return r.onHoverStart},get"on:hoverend"(){return r.onHoverEnd},get"on:pressstart"(){return r.onPressStart},get"on:pressend"(){return r.onPressEnd},get"on:viewenter"(){return r.onViewEnter},get"on:viewleave"(){return r.onViewLeave}},l))}})},qt=new Proxy(It,{get:(n,i)=>n=>t(It,e(n,{tag:i}))});export{qt as Motion,Pt as Presence,Mt as PresenceContext,Lt as createMotion,Ct as motion};
