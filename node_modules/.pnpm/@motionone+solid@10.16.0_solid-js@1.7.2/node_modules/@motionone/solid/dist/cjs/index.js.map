{"version":3,"file":"index.js","sources":["../../src/presence.tsx","../../src/primitives.ts","../../src/motion.tsx"],"sourcesContent":["import { createContext, FlowComponent } from \"solid-js\"\nimport { mountedStates } from \"@motionone/dom\"\nimport { resolveFirst } from \"@solid-primitives/refs\"\nimport { createSwitchTransition } from \"@solid-primitives/transition-group\"\nimport { ParentContext } from \"./motion\"\nimport { onCompleteExit } from \"./primitives\"\nimport { Options } from \"./types\"\n\nexport type PresenceContextState = () => boolean\nexport const PresenceContext = createContext<PresenceContextState>()\n\n/**\n * Perform exit/enter trantisions of children `<Motion>` components.\n *\n * accepts props:\n * - `initial` – *(Defaults to `true`)* – If `false`, will disable the first animation on all child `Motion` elements the first time `Presence` is rendered.\n * - `exitBeforeEnter` – *(Defaults to `false`)* – If `true`, `Presence` will wait for the exiting element to finish animating out before animating in the next one.\n *\n * @example\n * ```tsx\n * <Presence exitBeforeEnter>\n *   <Show when={toggle()}>\n *     <Motion.div\n *       initial={{ opacity: 0 }}\n *       animate={{ opacity: 1 }}\n *       exit={{ opacity: 0 }}\n *     />\n *   </Show>\n * </Presence>\n * ```\n */\nexport const Presence: FlowComponent<{\n  initial?: boolean\n  exitBeforeEnter?: boolean\n}> = (props) => {\n  let initial = props.initial !== false\n\n  const render = (\n    <PresenceContext.Provider value={() => initial}>\n      <ParentContext.Provider value={undefined}>\n        {createSwitchTransition(\n          resolveFirst(() => props.children),\n          {\n            appear: initial,\n            mode: props.exitBeforeEnter ? \"out-in\" : \"parallel\",\n            onExit(el, remove) {\n              const state = mountedStates.get(el)\n              if (state && (state.getOptions() as Options).exit)\n                onCompleteExit(el, remove)\n              else remove()\n            },\n          }\n        )}\n      </ParentContext.Provider>\n    </PresenceContext.Provider>\n  )\n\n  initial = true\n  return render\n}\n","import {\n  createMotionState,\n  createStyles,\n  MotionState,\n  style,\n} from \"@motionone/dom\"\nimport { isFunction } from \"@motionone/utils\"\nimport {\n  Accessor,\n  createEffect,\n  onCleanup,\n  onMount,\n  useContext,\n} from \"solid-js\"\nimport { PresenceContext, PresenceContextState } from \"./presence\"\nimport { Options } from \"./types\"\n\nexport const onCompleteExit = (el: Element, fn: VoidFunction) =>\n  el.addEventListener(\"motioncomplete\", fn)\n\n/** @internal */\nexport function createAndBindMotionState(\n  el: () => Element,\n  options: Accessor<Options>,\n  presenceState?: PresenceContextState,\n  parentState?: MotionState\n) {\n  const state = createMotionState(\n    presenceState?.() === false ? { ...options(), initial: false } : options(),\n    parentState\n  )\n\n  onMount(() => {\n    const unmount = state.mount(el())\n    onCleanup(() => {\n      if (presenceState && options().exit) {\n        state.setActive(\"exit\", true)\n        onCompleteExit(el(), unmount)\n      } else unmount()\n    })\n    isFunction(options) && createEffect(() => state.update(options()))\n  })\n\n  return [state, createStyles(state.getTarget())] as const\n}\n\n/**\n * createMotion provides MotionOne as a compact Solid primitive.\n *\n * @param target Target Element to animate.\n * @param options Options to effect the animation.\n * @param presenceState Optional PresenceContext override, defaults to current parent.\n * @returns Object to access MotionState\n */\nexport function createMotion(\n  target: Element,\n  options: Accessor<Options> | Options,\n  presenceState?: PresenceContextState\n): MotionState {\n  const [state, styles] = createAndBindMotionState(\n    () => target,\n    typeof options === \"function\" ? options : () => options,\n    presenceState\n  )\n\n  for (const key in styles) {\n    style.set(target, key, styles[key])\n  }\n\n  return state\n}\n\n/**\n * motion is a Solid directive that makes binding to elements easier.\n *\n * @param el Target Element to bind to.\n * @param props Options to effect the animation.\n */\nexport function motion(el: Element, props: Accessor<Options>) {\n  createMotion(el, props, useContext(PresenceContext))\n}\n","import type {\n  MotionComponentProps,\n  MotionProxy,\n  MotionProxyComponent,\n} from \"./types\"\nimport { Dynamic } from \"solid-js/web\"\nimport { useContext, splitProps, JSX, createContext } from \"solid-js\"\nimport { createAndBindMotionState } from \"./primitives\"\nimport { combineStyle } from \"@solid-primitives/props\"\nimport { MotionState } from \"@motionone/dom\"\nimport { PresenceContext } from \"./presence\"\n\nconst OPTION_KEYS = [\n  \"initial\",\n  \"animate\",\n  \"inView\",\n  \"inViewOptions\",\n  \"hover\",\n  \"press\",\n  \"variants\",\n  \"transition\",\n  \"exit\",\n] as const\n\nconst ATTR_KEYS = [\n  \"tag\",\n  \"ref\",\n  \"style\",\n  \"onMotionStart\",\n  \"onMotionComplete\",\n  \"onHoverStart\",\n  \"onHoverEnd\",\n  \"onPressStart\",\n  \"onPressEnd\",\n  \"onViewEnter\",\n  \"onViewLeave\",\n] as const\n\nexport const ParentContext = createContext<MotionState>()\n\n/** @internal */\nexport const MotionComponent = (\n  props: MotionComponentProps & {\n    tag?: string\n    ref?: any\n    style?: JSX.CSSProperties | string\n  }\n) => {\n  const [options, , attrs] = splitProps(props, OPTION_KEYS, ATTR_KEYS)\n\n  const [state, style] = createAndBindMotionState(\n    () => root,\n    () => ({ ...options }),\n    useContext(PresenceContext),\n    useContext(ParentContext)\n  )\n\n  let root!: Element\n  return (\n    <ParentContext.Provider value={state}>\n      <Dynamic\n        ref={(el: Element) => {\n          root = el\n          props.ref?.(el)\n        }}\n        component={props.tag || \"div\"}\n        style={props.style ? combineStyle(props.style, style) : style}\n        on:motionstart={props.onMotionStart}\n        on:motioncomplete={props.onMotionComplete}\n        on:hoverstart={props.onHoverStart}\n        on:hoverend={props.onHoverEnd}\n        on:pressstart={props.onPressStart}\n        on:pressend={props.onPressEnd}\n        on:viewenter={props.onViewEnter}\n        on:viewleave={props.onViewLeave}\n        {...attrs}\n      />\n    </ParentContext.Provider>\n  )\n}\n\n/**\n * Renders an animatable HTML or SVG element.\n *\n * @component\n * Animation props:\n * - `animate` a target of values to animate to. Accepts all the same values and keyframes as Motion One's [animate function](https://motion.dev/dom/animate). This prop is **reactive** – changing it will animate the transition element to the new state.\n * - `transition` for changing type of animation\n * - `initial` a target of values to animate from when the element is first rendered.\n * - `exit` a target of values to animate to when the element is removed. The element must be a direct child of the `<Presence>` component.\n *\n * @example\n * ```tsx\n * <Motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }}/>\n * ```\n *\n * Interaction animation props:\n *\n * - `inView` animation target for when the element is in view\n * - `hover` animate when hovered\n * - `press` animate when pressed\n *\n * @example\n * ```tsx\n * <Motion.div hover={{ scale: 1.2 }} press={{ scale: 0.9 }}/>\n * ```\n */\nexport const Motion = new Proxy(MotionComponent, {\n  get:\n    (_, tag: string): MotionProxyComponent<any> =>\n    (props) =>\n      <MotionComponent {...props} tag={tag} />,\n}) as MotionProxy\n"],"names":["PresenceContext","createContext","Presence","props","initial","render","_$createComponent","undefined","createSwitchTransition","resolveFirst","children","appear","mode","exitBeforeEnter","onExit","el","remove","state","mountedStates","get","getOptions","exit","onCompleteExit","fn","addEventListener","createAndBindMotionState","options","presenceState","parentState","createMotionState","onMount","unmount","mount","onCleanup","setActive","isFunction","createEffect","update","createStyles","getTarget","createMotion","target","styles","key","style","set","motion","useContext","OPTION_KEYS","ATTR_KEYS","ParentContext","MotionComponent","attrs","splitProps","root","Dynamic","_$mergeProps","ref","tag","_$memo","combineStyle","onMotionStart","onMotionComplete","onHoverStart","onHoverEnd","onPressStart","onPressEnd","onViewEnter","onViewLeave","Motion","Proxy","_"],"mappings":"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"}