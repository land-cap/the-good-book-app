import { isServer } from 'solid-js/web';
import { makeEventListener } from '@solid-primitives/event-listener';
import { noop, createHydratableSignal, entries } from '@solid-primitives/utils';
import { createHydratableStaticStore } from '@solid-primitives/static-store';
import { createHydratableSingletonRoot } from '@solid-primitives/rootless';

// src/index.ts
function makeMediaQueryListener(query, callback) {
  if (isServer) {
    return noop;
  }
  const mql = typeof query === "string" ? window.matchMedia(query) : query;
  return makeEventListener(mql, "change", callback);
}
function createMediaQuery(query, serverFallback = false) {
  if (isServer) {
    return () => serverFallback;
  }
  const mql = window.matchMedia(query);
  const [state, setState] = createHydratableSignal(serverFallback, () => mql.matches);
  const update = () => setState(mql.matches);
  makeEventListener(mql, "change", update);
  return state;
}
function createPrefersDark(serverFallback) {
  return createMediaQuery("(prefers-color-scheme: dark)", serverFallback);
}
var usePrefersDark = /* @__PURE__ */ createHydratableSingletonRoot(
  createPrefersDark.bind(void 0, false)
);
var getEmptyMatchesFromBreakpoints = (breakpoints) => {
  const matches = {};
  entries(breakpoints).forEach(([key]) => matches[key] = false);
  return matches;
};
function createBreakpoints(breakpoints, options = {}) {
  const fallback = options.fallbackState ?? getEmptyMatchesFromBreakpoints(breakpoints);
  if (isServer || !window.matchMedia)
    return fallback;
  const { mediaFeature = "min-width", watchChange = true } = options;
  const [matches, setMatches] = createHydratableStaticStore(fallback, () => {
    const matches2 = {};
    entries(breakpoints).forEach(([token, width]) => {
      const mql = window.matchMedia(`(${mediaFeature}: ${width})`);
      matches2[token] = mql.matches;
      if (watchChange)
        makeEventListener(mql, "change", (e) => setMatches(token, e.matches));
    });
    return matches2;
  });
  return matches;
}

export { createBreakpoints, createMediaQuery, createPrefersDark, makeMediaQueryListener, usePrefersDark };
